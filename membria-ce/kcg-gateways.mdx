---
title: "KCG и гейтвеи (бэкенд)"
description: "Бэкенд-граф, DoD-эскалация, валидация Советом и неизменяемое хранение"
---

## Ответственность только на стороне бэкенда

KCG + DoD + Peaq + Arweave — это бэкенд для Membria CE, независимо от того, запускается ли клиент на устройстве или в облаке. Клиентский слой никогда не пишет в граф напрямую; он только инициирует DoD-эскалацию (Distillation on Demand), когда требуются внешние знания.

## Гибридная архитектура

- **Peaq:** слой логики/графа, упорядочивание событий, правила консенсуса.
- **Arweave:** неизменяемое хранилище для полезной нагрузки (ответы JSON-LD, архивы, манифесты).
- **Гейтвеи:** валидаторы + индексаторы, которые читают из Arweave и подтверждают консенсус в Peaq.

## Краткий обзор жизненного цикла

1. **Определение контракта знаний** в Peaq (исполняемая семантическая модель).
2. **Запись полезной нагрузки**: DoD-агент упаковывает JSON-LD, тегирует его, загружает в Arweave и получает ArTxID.
3. **Предложение в Peaq**: легкое событие связывает полезную нагрузку с исходным запросом через поле `cause`.
4. **Консенсус гейтвеев**: валидаторы получают, проверяют и голосуют (пакетно для снижения затрат).
5. **Финализация**: событие валидации закрывает намерение (Intent); знание становится доступным для запросов. Гейтвей возвращает результат вместе с **сигналами DI** (сдвиги состояний VoI/POMDP) клиенту.

## Путь чтения гейтвея

Гейтвеи никогда не читают чаты. Они:

- Проверяют «горячий» кэш.
- Обращаются к семантическим и векторным индексам.
- Извлекают конкретную полезную нагрузку из Arweave по ArTxID.
- Собирают SCR-бандлы (Selective Context Retrieval) для клиента.
- Эскалируют запрос к LLM-учителям только при низкой уверенности.

## Индекс и конфиденциальность

- «Горячий» кэш + семантический + векторный + ArTx индексы обеспечивают низкую задержку.
- Полезная нагрузка может быть зашифрована (шифрование перед сохранением с использованием CEK и событий KeyGrant).
- Форки разрешаются через MergeEvents; пакетная обработка и канонические хеши гарантируют идемпотентность.

## Почему это важно

Бэкенд-граф является источником истины для обновлений знаний, эскалаций в Совет и неизменяемого хранения. Клиент фиксирует решения; бэкенд верифицирует и хранит знания. Они разделены на уровне архитектуры, но взаимосвязаны через DoD для подпитки **движка Decision Intelligence** на стороне клиента.
