---
title: "Эвристика DBB и маршрутизация LoRA"
description: "Детектирование решений, скоринг уверенности и политика роутера LoRA"
---

## 1. Decision Black Box (DBB)

### 1.1 Цель

Decision Black Box (DBB) — это фоновый агент рассуждений, отвечающий за:
- Детектирование именно решений, а не просто разговоров.
- Извлечение контекста рассуждений в момент принятия решения.
- Сохранение каузальной (причинно-следственной) структуры для Decision Surface (DS).
- Предоставление сигнальных данных для **Decision Intelligence** (скоринг VoI и обновление POMDP).
- Бесшумную работу без прерывания рабочих процессов пользователя.

DBB — это не функция интерфейса. Это система времени выполнения (inference-time), которая превращает зашумленные потоки взаимодействия в долговечные записи о решениях.

---

## 2. Входные потоки DBB

DBB обрабатывает несколько потоков данных от пользователя:
- Диалоги с ИИ (Membria, Claude, Codex и т. д.).
- Коммиты кода / диффы.
- Документы и заметки.
- Описания задач.
- Явные действия пользователя (принять, отклонить, развернуть, слить).

Все потоки рассматриваются как неструктурированные сигналы.

---

## 3. Эвристика детектирования решений

DBB не полагается на один классификатор. Он использует композицию эвристик со скорингом уверенности.

### 3.1 Типы сигналов решений

Каждое обнаруженное событие оценивается по следующим измерениям:

| Тип сигнала | Описание |
| --- | --- |
| Язык обязательств | «Мы сделаем», «Давайте», «Я выбираю», «Окончательное решение» |
| Необратимость | Действия, влекущие затраты или фиксацию (деплой, мерж, оплата) |
| Закрытие альтернатив | Явный отказ от других вариантов |
| Темпоральная привязка | Ссылки на дедлайны, таймлайны, следующие шаги |
| Утверждение ответственности | «Я решил», «Мы договорились», «Я одобряю» |
| Триггер исполнения | Последующие задачи, изменения в коде, события календаря |

---

## 4. Модель скоринга уверенности

DBB присваивает бал уверенности в решении (Decision Confidence Score, DCS) в диапазоне [0.0 - 1.0].

### 4.1 Формула скоринга (концептуальная)

DCS = sum(weight_i * signal_i) - ambiguity_penalty

Где:
- signal_i в диапазоне [0,1].
- веса калибруются пользователем со временем.
- штраф за двусмысленность (ambiguity penalty) растет при:
  - использовании спекулятивного языка;
  - условных формулировках;
  - гипотетическом времени глаголов.

### 4.2 Диапазоны уверенности

| Диапазон DCS | Классификация | Поведение |
| --- | --- | --- |
| >= 0.75 | Подтвержденное решение | Немедленно записывается в DBB |
| 0.45 - 0.75 | Предварительное решение | Сохраняется как временное, выводится мягко |
| < 0.45 | Исследование | Игнорируется для DS, хранится только как контекст |

---

## 5. Обработка ложных срабатываний (Модель без трения)

DBB исходит из того, что ложные срабатывания неизбежны.

### 5.1 Цикл коррекции

Предварительные решения появляются в DS как сигналы с низким приоритетом. Пользователь может:
- Подтвердить.
- Пометить как исследование.
- Игнорировать.

Все действия выполняются в один клик, асинхронно и без модальных окон.

---

## 6. Схема вывода DBB (абстрактная)

Каждое записанное решение включает:
- ID решения.
- Метку времени.
- Балл уверенности.
- Трассировку рассуждений (структурированное резюме).
- Ссылки на источники (ID чатов, хеши коммитов, документы).
- Обнаруженные предположения.
- Изначальное предсказание (если доступно).
- **Сигналы DI:** Задержка ответа, скептические маркеры, признаки избыточности и дельты уверенности для обновления состояния убеждений.

---

## 7. Связь с Decision Surface (DS)

- DS читает только выходы DBB.
- Сырая история чата никогда не выводится напрямую.
- DS отображает:
  - **Открытые петли, ранжированные по VoI.**
  - **Скрытые разногласия (POMDP).**
  - Дрифт.
  - Нерешенные предположения.
  - Дельты исходов.

DBB предоставляет «сырую» структурную истину; **движок Decision Intelligence** обеспечивает приоритизацию и наложения состояний убеждений.

---

## 8. Интеграция с движком Decision Intelligence (DI)

DBB является основным «сенсором» для движка DI.

### 8.1 Цикл скоринга VoI
DBB извлекает из потока данных информацию о «ставках» и «недостающих данных». Движок DI использует их для расчета **ценности информации (VoI)**, которую DS применяет для ранжирования открытых петель.

### 8.2 Обновление убеждений POMDP
DBB фиксирует подпороговые метаданные:
- задержку ответов между членами команды;
- паттерны скептических вопросов;
- сигналы red-teaming.
Эти данные передаются как сигналы в трекер **POMDP (Partially Observable Markov Decision Process)** движка DI для обнаружения «поверхностного согласия».

---

## 9. Политика роутера LoRA

Membria не полагается на одну монолитную модель. Вместо этого:
- Базовая SLM обрабатывает большинство взаимодействий.
- Адаптеры LoRA предоставляют доменную экспертизу.
- Эскалация происходит только при недостаточной уверенности.

---

## 10. Типы LoRA

| Тип LoRA | Область действия |
| --- | --- |
| Персональная LoRA | Один пользователь |
| Доменная LoRA | Воркспейс / проект |
| LoRA задачи | Узкая функция (например, юридический обзор) |
| LoRA от Совета | Очищенный синтез экспертных оценок |

---

## 13. Политика маршрутизации (По умолчанию)

### 13.1 Обычный путь (около 80-90%)

Базовая SLM + персональная LoRA (если есть) + локальный GraphRAG.

Используется, когда:
- Уверенность >= порога.
- Запрос в рамках известного домена.
- Нет противоречивых сигналов.

### 13.2 Путь эксперта

Базовая SLM + персональная LoRA + доменная LoRA + локальный GraphRAG.

Триггер:
- Сильное соответствие домену.
- Прошлые оценки показывают пользу LoRA.
- Уверенность пограничная, но приемлемая.

### 13.3 Путь эскалации

Триггер:
- Уверенность < минимального порога.
- Обнаружены противоречивые рассуждения.
- Контекст решения с высоким риском.

---

## 17. Ключевые принципы проектирования

- Решения > разговоры.
- Тишина > прерывание.
- Персональная калибровка > глобальная оптимизация.
- Эскалация только при необходимости.
- Никогда не скрывать неопределенность.

---

## 18. Резюме

DBB гарантирует, что важные моменты фиксируются без усилий со стороны пользователя. Маршрутизация LoRA обеспечивает накопление экспертизы без потери доверия. Вместе они формируют костяк рассуждений Membria CE.
