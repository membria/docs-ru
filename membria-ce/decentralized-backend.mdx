---
title: "Децентрализованный бэкенд"
description: "KCG, DoD, гейтвеи и архитектура децентрализованного хранения для Membria CE"
---
> Membria CE использует децентрализованный бэкенд для верификации, хранения и совместного использования артефактов знаний, которые выходят за рамки локальной уверенности. Этот бэкенд отделен от рантайма клиента и вызывается только при необходимости эскалации.

## Аннотация

Membria использует гибридную блокчейн-архитектуру, которая разделяет графовую логику и постоянное хранение данных. Протокол Peaq управляет транзакционной графовой логикой и консенсусом, в то время как Arweave хранит неизменяемые полезные данные (payloads). Система спроектирована для поддержки дистилляции по требованию (Distillation on Demand, DoD): результаты работы мощных LLM-учителей верифицируются, записываются как неизменяемые события и передаются обратно локальным моделям через генерацию с дополнением кэшем (CAG).

## 1: Ядро архитектуры — симбиотическая гибридная модель

Membria задействует две специализированные сети:

- Протокол Peaq: слой логики и графа.
- Arweave: слой постоянного хранения данных.

### Peaq Protocol — слой логики и графа

Peaq обрабатывает темпоральный семантический граф (Temporal Semantic Graph) как DAG (направленный ациклический граф) неизменяемых событий. Каждое событие подписывается и включает такие поля, как актор, метка времени и причина, создавая проверяемую историю.

### Arweave — слой постоянного хранения

Arweave хранит тяжелые полезные данные (верифицированные ответы, артефакты знаний). Peaq хранит легкие заголовки и ссылки на транзакции Arweave, чтобы операции в чейне оставались быстрыми.

### Общая схема

```mermaid
graph TB
    %% Client Layer
    subgraph Client["КЛИЕНТСКИЙ СЛОЙ"]
        direction LR
        SLM["Пользователь или SLM"]
        DoDAgent["DoD Агент\\nЛегкий клиент"]
        SLM <--> DoDAgent
    end

    %% Processing Layer - Main Gateway Logic
    subgraph Gateway["СЛОЙ ГЕЙТВЕЕВ - Движок жизненного цикла знаний"]
        direction LR

        subgraph Input["ВХОД"]
            Router["API Роутер"]
        end

        subgraph FastPath["БЫСТРЫЙ ПУТЬ"]
            Cache["Кэш графа состояний"]
            SemanticSearch["Семантический поиск\\nGraph Transformer + cuGraph"]
        end

        subgraph SlowPath["МЕДЛЕННЫЙ ПУТЬ"]
            LLMEscalator["LLM Эскалатор"]
            KnowledgeCreator["Создатель знаний\\nPayload + Arweave + Консенсус"]
        end

        subgraph Background["ФОНОВЫЙ РЕЖИМ"]
            EventProcessor["Процессор событий"]
            ArchiveEngine["Движок архивации\\nBatching + DuckDB + Parquet"]
        end
    end

    %% Teacher Services Layer
    subgraph Teacher["СЕРВИСЫ-УЧИТЕЛЯ"]
        LLMX["LLM-учитель\\nOpenRouter"]
    end

    %% Blockchain Layer
    subgraph Blockchain["БЛОКЧЕЙН PEAQ"]
        direction LR
        PeaqSubgraph["Peaq Subgraph\\npallet-kcg"]
        PeaqConsensus["Движок консенсуса\\nЛогика верификации"]
    end

    %% Storage Layer
    subgraph Storage["ПОСТОЯННОЕ ХРАНИЛИЩЕ - Arweave Permaweb"]
        direction LR
        JSONFiles["JSON Ответы\\nanswers/{id}.json"]
        ParquetArchives["Архивы Parquet\\nbatches/{ts}.parquet"]
        ManifestIndex["Индекс манифеста\\nметаданные архива"]
    end

    %% Main Flow - Client Request
    DoDAgent -->|"API запрос"| Router

    %% Fast Path Flow
    Router --> Cache
    Router --> SemanticSearch
    Cache --> SemanticSearch
    SemanticSearch -->|"Попадание в кэш"| Router
    Router -->|"Быстрый ответ"| DoDAgent

    %% Slow Path Flow
    Router -->|"Промах кэша"| LLMEscalator
    LLMEscalator <--> LLMX
    LLMEscalator --> KnowledgeCreator
    KnowledgeCreator <--> JSONFiles
    KnowledgeCreator <--> PeaqSubgraph
    PeaqSubgraph --> PeaqConsensus
    KnowledgeCreator -->|"Новый ответ + Сигналы DI"| Router

    %% Background Processing
    PeaqSubgraph --> EventProcessor
    EventProcessor --> Cache
    EventProcessor --> ArchiveEngine
    ArchiveEngine <--> ParquetArchives
    ArchiveEngine --> ManifestIndex

    %% State Sync
    PeaqSubgraph -.->|"Синхронизация состояния"| Cache
```

## 2: Децентрализованный граф знаний (DKG) — слои и компоненты

### Слой онтологии — гибкие словари

- Словари — это многоразовые коллекции концепций и отношений для конкретной области.
- Публичные словари (например, Schema.org) могут быть использованы повторно; поддерживаются приватные словари для кастомных доменов.
- Определения онтологий существуют как генезис-события в Peaq.

### Слой знаний — верифицированные ответы как цепочки событий

- Исполняемые семантические модели (Executable Semantic Models) определяют схему и правила валидации для каждого типа знаний.
- Верифицированные ответы хранятся как цепочки событий, связанных полями причин (cause), создавая полный аудиторский след.

## 3: Жизненный цикл знаний — пошаговый протокол

Система рассматривает эскалацию запроса как намерение «Запрос на дистилляцию знаний» (Knowledge Distillation Request).

### Шаг 1: Определение контракта знаний в Peaq

Эксперты развертывают исполняемую семантическую модель (BSL или эквивалент) как генезис-событие. Это определяет правила для валидных записей знаний.

### Шаг 2: Предложение новых знаний

DoD-агент получает ответ от LLM-учителя, записывает полезную нагрузку в Arweave и предлагает её в Peaq.

### Шаг 3: Консенсус гейтвеев

Гейтвеи проверяют предложение на соответствие контракту и голосуют через транзакции Peaq (пакетно, где это возможно).

### Шаг 4: Финализация результата

Событие валидации записывается в Peaq с финальным статусом и баллом уверенности. Этот результат возвращается клиенту вместе с **сигналами DI** (например, дельтой состояния убеждений для трекера POMDP) для обновления Decision Surface.

## 4: Протокол записи в Arweave

1. Запускается после ответа LLM-учителя и перед предложением в Peaq.
2. Полезная нагрузка собирается в формате JSON-LD для машиночитаемой семантики.
3. Создается и тегируется транзакция Arweave.
4. Транзакция подписывается и транслируется (допускается объединение в бандлы для снижения стоимости).
5. Arweave возвращает ArTxID.

## 10: Заключение

Arweave обеспечивает персистентность, а Peaq — логику и верификацию. Вместе они создают децентрализованный граф знаний, который доступен для аудита, эффективен по стоимости и может использоваться повторно на разных устройствах и разными пользователями.
