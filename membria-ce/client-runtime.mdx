---
title: "RFC рантайма клиента"
description: "Полная спецификация рантайма и модель выполнения"
---

## 0. Краткое резюме

Клиент Membria CE — это **рантайм**, который находится между пользователем и набором ИИ-возможностей. Он обеспечивает:

- **Привычный чат** (базовый уровень для продвинутых пользователей).
- **Слой устойчивого интеллекта**, который накапливается со временем: память, GraphRAG и экспертные адаптеры навыков (skill adapters).
- **Decision Black Box (DBB)** — «черный ящик решений», извлекающий долговечные артефакты решений из зашумленных рабочих потоков.
- **Decision Surface (DS)** — интерфейс, который читает данные DBB + память (а не сырой чат), показывая то, что важно, с ранжированием по **ценности информации (VoI)**.
- **Движок Decision Intelligence (DI)**, который отслеживает **состояния убеждений POMDP** для обнаружения скрытых разногласий и оптимизирует последовательность принятия решений.
- **Модель выполнения local-first** (при доступности self-hosted версии) с **эскалацией в облако** и **децентрализованным кэшем знаний** для предотвращения сброса интеллекта.

Рантайм клиента должен быть быстрым, предсказуемым и объяснимым. Задержки и «медлительность RAG» должны активно минимизироваться с помощью кэширования, поэтапного извлечения и оптимистичного UX.

---

## 1. Цели

### 1.1 Продуктовые цели
1. **Накопительный интеллект:** знания и рассуждения пользователя должны суммироваться, а не обнуляться в каждом чате/инструменте/модели.
2. **Объяснимость по умолчанию:** ответы должны быть прослеживаемы до источников и артефактов рассуждений (цитаты, цепочки связей, происхождение).
3. **Приоритет локальности (Local-first):** выполнение как можно большего объема работы локально (SLM + память + GraphRAG) при включенном self-hosted режиме.
4. **Выборочная эскалация:** использование дорогих моделей только тогда, когда локальных возможностей + кэша + графа недостаточно.
5. **Захват решений в масштабе:** извлечение поворотных моментов и решений из десятков чатов/инструментов без навязывания специальных ритуалов.
6. **Производительность для продвинутых пользователей:** минимизация трения; поддержка видимости процессов «в стиле терминала» без превращения UI в консоль.

---

## 2. Что не является целью (Non-goals)

- Замена интерфейсов всех внешних инструментов (Slack, Gmail, GitHub, IDE) в версии v1.
- Обучение новой базовой модели (foundation model) с нуля.
- «Абсолютная правда» или гарантированная корректность; вместо этого: **уверенность + происхождение + эскалация**.
- Единая монолитная архитектура типа «один промпт для всего».

---

## 3. Определения и терминология

- **Клиент (Client):** приложение для пользователя + локальные сервисы рантайма (десктоп/мобильное/веб, в зависимости от платформы).
- **SLM:** малая локальная модель, используемая для быстрых и дешевых рассуждений (открытые веса).
- **Council (Совет):** набор более мощных LLM, используемых при эскалации (облако).
- **KCG / Глобальный кэш знаний:** децентрализованный слой, хранящий верифицированные артефакты знаний и их происхождение.
- **CAG:** генерация с дополнением кэшем; повторное использование проверенных ответов и промежуточных артефактов.
- **GraphRAG:** извлечение данных с использованием графа знаний + сходства векторов + ранжирования с учетом графа и цитирования.
- **ThoughtUnit:** нормализованный атомарный фрагмент, извлеченный из источников (сообщение/фрагмент документа) с метаданными.
- **DBB:** Decision Black Box; агент/процесс, который структурно детектирует и логирует решения и поворотные моменты.
- **DS:** Decision Surface; главный интерфейс, построенный на базе DBB + графа памяти.
- **Движок DI:** движок Decision Intelligence; оптимизирует взаимодействие человека и ИИ через скоринг VoI, трекинг состояний POMDP и выстраивание последовательностей.
- **VoI:** ценность информации (Value of Information); ожидаемый прирост полезности от получения дополнительных данных перед принятием решения.
- **POMDP:** частично наблюдаемый марковский процесс принятия решений; используется для отслеживания вероятностного состояния командного консенсуса.

---

## 4. Системный контекст и продуктовые линейки

Membria поставляется как:

1. **Membria Cloud (управляемый сервис)** — первый путь релиза.
2. **Membria Self-Hosted / Local** — последующий путь для выполнения локально/на устройстве.
3. **Децентрализованный бэкенд знаний** — остается в облаке и является общим для всех продуктов (Personal/SMB/Enterprise) с учетом прав доступа и условий владения.

Рантайм клиента должен быть совместим как с облачным, так и с локальным режимами без переписывания интерфейса.

---

## 5. Обзор архитектуры

### 5.1 Основные модули
- **Оболочка UI (UI Shell)**: Чат, Decision Surface, Поиск, панель Источников/Файлов.
- **Оркестратор (Роутер)**: выбирает путь модели, глубину извлечения, вызовы инструментов, стратегию кэширования.
- **Локальные хранилища**: SQLite (транзакционное), DuckDB (аналитическое), хранилище эмбеддингов, хранилище графа.
- **Движок GraphRAG**: индексация, извлечение, ранжирование, сборка цитат.
- **Движок DBB**: прием потока событий -> извлечение -> объекты решений.
- **Движок Decision Intelligence (DI)**: скоринг VoI, байесовское обновление POMDP, оптимизация последовательностей.
- **Шлюз эскалации (Escalation Gateway)**: вызовы Совета, поиск в KCG, контроль затрат.
- **Куратор (Curator)**: верификация, слияние, происхождение, политика обратной записи.
- **SkillForge**: управление LoRA и опциональный рабочий процесс обучения.

---

## 6. Источники данных и индексация (Ingestion)

### 6.1 Поддерживаемые источники (начальные)
- Google Drive (документы, PDF)
- Электронная почта
- Slack
- Экспорт WhatsApp (где это возможно)
- Инструменты чата: Claude Code, логи Codex (CLI-трейсы), экспорт ChatGPT
- Форумы/комментарии (на основе импорта)

---

## 7. Хранение и модель данных

### 7.1 SQLite (транзакционное ядро)
**Цель:** быстрая локальная запись, состояние синхронизации, метаданные, логи событий, права доступа.

Рекомендуемые таблицы:
- `sources`, `thought_units`, `threads`, `events`, `decisions`, `decision_links`, `cache_entries`, `skills`.

---

## 12. Движок Decision Intelligence (DI)

### 12.1 Миссия
Движок DI оптимизирует цикл принятия решений, обрабатывая сигналы DBB и данные графа.

### 12.2 Возможности
- **Скоринг VoI:** Динамически вычисляет ценность информации для каждой «Открытой петли». Если решение имеет высокие ставки, но мало данных, его VoI растет, поднимая его в топ DS.
- **Трекинг убеждений POMDP:** Моделирует консенсус как скрытое состояние. Использует байесовские обновления на основе сигналов взаимодействия для обнаружения «Поверхностного согласия» (высокое явное согласие при низкой уверенности в консенсусе).
- **MCTS-последовательности:** Исследует дерево потенциальных решений для рекомендации порядка, минимизирующего критический путь проекта.

---

## 13. Decision Surface (DS)

### 13.1 Почему DS — это главный экран
Продвинутые пользователи тонут в контексте. DS отвечает на вопросы:
- «Что открыто?»
- «Где произошел дрифт?»
- «Что должно быть решено?»
- «Что мы решили раньше и к чему это привело?»

### 13.2 DS читает DBB, а не чат
DS строится на основе:
- **Открытых петель, ранжированных по VoI** (нерешенные треды, приоритизированные по потенциальной полезности).
- **Оповещений о скрытых разногласиях** (предупреждения на базе POMDP о низком консенсусе).
- **Дрифта предположений** (убеждения, изменившиеся со временем/источниками).
- **Прецедентов** (похожие прошлые решения и их исходы).
- Состояния отслеживания исходов.

### 13.3 Карточки DS (понятная терминология)
Избегайте жаргона в названиях по умолчанию. Используйте понятные метки:
- Открытые петли (Open loops)
- Решения, ожидающие подтверждения
- Изменившиеся предположения
- Похожие прошлые выборы (прецеденты)
- Нехватка доказательств / неясности

Сложные метки могут быть доступны в «экспертном режиме».

---

## 18. Дорожная карта (Roadmap рантайма)

1. Облачный MVP: Чат + Источники + объяснимое извлечение + кэширование.
2. DBB MVP: извлечение решений из чата + минимальный DS.
3. Фаза Decision Intelligence: ранжирование по VoI и трекинг убеждений POMDP.
4. Цикл Совет + Куратор + кэширование KCG.
5. Рантайм self-hosted: локальный SLM + локальные хранилища + локальный GraphRAG.
6. SkillForge: курируемые обновления LoRA + среда оценки.
7. GPU-ускорение: опциональное ускорение ранжирования графа и эмбеддингов.
